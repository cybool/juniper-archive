#jinja2: lstrip_blocks: "True (or False)", trim_blocks: "True (or False)"
{#- ---------------------------------------------------------------------------------- #}
{# Junos Configuration stanza for "security"                                           #}
{# ------------------------------------------------------------------------------------#}
{% if configuration_security is defined %}
security {
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.log                                                                 #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.log is defined %}
    log {
        {% if configuration_security.log.mode is defined %}
        mode {{ configuration_security.log.mode }};
        {% endif %}
        {% if configuration_security.log.mode is defined %}
        format {{ configuration_security.log.format }};
        {% endif %}
        {% if configuration_security.log.report is defined %}
        report;
        {% endif %}
        {% if configuration_security.log.source_address is defined %}
        source-address {{ configuration_security.log.source_address }};
        {% endif %}
        {% if configuration_security.log.source_interface is defined %}
        source-interface {{ configuration_security.log.source_interface }};
        {% endif %}
        {% if configuration_security.log.transport is defined %}
        transport {
            protocol {{ configuration_security.log.transport.protocol }};
        }
        {% endif %}
        {% if configuration_security.log.stream is defined %}
        stream {{ configuration_security.log.stream.name }} {
            severity {{ configuration_security.log.stream.severity }};
            format {{ configuration_security.log.stream.format }};
            {# category {{ configuration_security.log.stream.category }}; #}
            host {
                {{ configuration_security.log.stream.host.ipaddr }};
                {% if configuration_security.log.stream.host.port is defined %}
                port {{ configuration_security.log.stream.host.port }};
                {% endif %}
            }
        }
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.ike                                                                 #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.ike is defined %}
    ike {
        {# ----------------------------------------------------------------------------------- #}
        {# IKE proposal                                                                        #}
        {# ----------------------------------------------------------------------------------- #}
        {% if configuration_security.ike.proposal is defined %}
        {% for each in configuration_security.ike.proposal %}
        proposal {{ each.name }} {
            authentication-method {{ each.authentication_method }};
            dh-group {{ each.dh_group }};
            authentication-algorithm {{ each.authentication_algorithm }};
            encryption-algorithm {{ each.encryption_algorithm}};
            lifetime-seconds {{ each.lifetime_seconds }};
        }
        {% endfor %}
        {% endif %}
        {# ----------------------------------------------------------------------------------- #}
        {# IKE policies                                                                        #}
        {# ----------------------------------------------------------------------------------- #}
        {% for each in configuration_security.ike.policy %}
        policy {{ each.name }} {
            {% if each.mode is defined %}
            mode {{ each.mode }};
            {% endif %}
            {% if each.proposals is defined %}
            proposals {{ each.proposals }};
            {% endif %}
            {% if each.proposal_set is defined %}
            proposal-set {{ each.proposal_set }};
            {% endif %}
            {% if each.pre_shared_key is defined %}
            pre-shared-key ascii-text "{{ each.pre_shared_key.ascii_text }}";
            {% endif %}
        }
        {% endfor %}
        {# ----------------------------------------------------------------------------------- #}
        {# IKE gateways                                                                        #}
        {# ----------------------------------------------------------------------------------- #}
        {% for each in configuration_security.ike.gateway %}
        gateway {{ each.name }} {
            {% if each.ike_policy is defined %}
            ike-policy {{ each.ike_policy }};
            {% endif %}
            {% if each.address is defined %}
            address {{ each.address }};
            {% endif %}
            {% if each.local_identity is defined %}
            {% if each.local_identity.hostname is defined %}
            local-identity hostname {{ each.local_identity.hostname.identity_hostname }};
            {% endif %}
            {% if each.local_identity.user_at_hostname is defined %}
            local-identity user-at-hostname "{{ each.local_identity.user_at_hostname.identity_user }}";
            {% endif %}
            {% endif %}
            {% if each.nat_keepalive is defined %}
            nat-keepalive {{ each.nat_keepalive }};
            {% endif %}
            {% if each.version is defined %}
            version {{ each.version }};
            {% endif %}
            {% if each.dead_peer_detection is defined %}
            dead-peer-detection {
                {% if each.dead_peer_detection.optimized is defined %}
                optimized;
                {% endif %}
                {% if each.dead_peer_detection.interval is defined %}
                interval {{ each.dead_peer_detection.interval }};
                {% endif %}
                {% if each.dead_peer_detection.threshold is defined %}
                threshold {{ each.dead_peer_detection.threshold }};
                {% endif %}
            }
            {% endif %}
            external-interface {{ each.external_interface }};

        }
        {% endfor %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.ipsec                                                               #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.ipsec is defined %}
    ipsec {
        {# ----------------------------------------------------------------------------------- #}
        {# configuration_security.ipsec.proposal                                                      #}
        {# ----------------------------------------------------------------------------------- #}
        {% if configuration_security.ipsec.proposal is defined %}
        {% if configuration_security.ipsec.proposal is not mapping and configuration_security.ipsec.proposal is not string %}
        {% for each in configuration_security.ipsec.proposal %}
        proposal {{ each.name }} {
            {% if each.protocol is defined %}
            protocol {{ each.protocol }};
            {% endif %}
            {% if each.authentication_algorithm is defined %}
            authentication-algorithm {{ each.authentication_algorithm }};
            {% endif %}
            {% if each.encryption_algorithm is defined %}
            encryption-algorithm {{ each.encryption_algorithm }};
            {% endif %}
            {% if each.lifetime_seconds is defined %}
            lifetime-seconds {{ each.lifetime_seconds }};
            {% endif %}
            {% if each.lifetime_kilobytes is defined %}
            lifetime-kilobytes {{ each.lifetime_kilobytes }};
            {% endif %}
        }
        {% endfor %}
        {% else %}
        proposal {{ configuration_security.ipsec.proposal.name }} {
            {% if configuration_security.ipsec.proposal.protocol is defined %}
            protocol {{ configuration_security.ipsec.proposal.protocol }};
            {% endif %}
            {% if configuration_security.ipsec.proposal.authentication_algorithm is defined %}
            authentication-algorithm {{ configuration_security.ipsec.proposal.authentication_algorithm }};
            {% endif %}
            {% if configuration_security.ipsec.proposal.encryption_algorithm is defined %}
            encryption-algorithm {{ configuration_security.ipsec.proposal.encryption_algorithm }};
            {% endif %}
            {% if configuration_security.ipsec.proposal.lifetime_seconds is defined %}
            lifetime-seconds {{ configuration_security.ipsec.proposal.lifetime_seconds }};
            {% endif %}
        }
        {% endif %}
        {% endif %}
        {# ----------------------------------------------------------------------------------- #}
        {# configuration_security.ipsec.policy                                                        #}
        {# ----------------------------------------------------------------------------------- #}
        {% if configuration_security.ipsec.policy is defined %}
        {% if configuration_security.ipsec.policy is not mapping and configuration_security.ipsec.policy is not string %}
        {% for each in configuration_security.ipsec.policy %}
        policy {{ each.name }} {
            {% if each.perfect_forward_secrecy is defined %}
            perfect-forward-secrecy {
                keys {{ each.perfect_forward_secrecy['keys'] }};
            }
            {% endif %}
            {% if each.proposals is defined %}
            proposals {{ each.proposals[0] }};
            {% endif %}
            {% if each.proposal_set is defined %}
            proposal-set {{ each.proposal_set }};
            {% endif %}
        }
        {% endfor %}
        {% else %}
        policy {{ configuration_security.ipsec.policy.name }} {
            {% if configuration_security.ipsec.policy.perfect_forward_secrecy is defined %}
            perfect-forward-secrecy {
                keys {{ configuration_security.ipsec.policy.perfect_forward_secrecy.keys }};
            }
            {% endif %}
            {% if configuration_security.ipsec.policy.proposals is defined %}
            proposals {{ configuration_security.ipsec.policy.proposals }};
            {% endif %}
            {% if configuration_security.ipsec.policy.proposal_set is defined %}
            proposal-set {{ configuration_security.ipsec.policy.proposal_set }};
            {% endif %}
        }
        {% endif %}
        {% endif %}
        {# ----------------------------------------------------------------------------------- #}
        {# configuration_security.ipsec.vpn                                                           #}
        {# ----------------------------------------------------------------------------------- #}
        {% if configuration_security.ipsec.vpn is defined %}
        {% if configuration_security.ipsec.vpn is not mapping and configuration_security.ipsec.vpn is not string %}
        {% for each in configuration_security.ipsec.vpn %}
        vpn {{ each.name }} {
            {% if each.bind_interface is defined %}
            {% if each.bind_interface['@inactive'] is defined %}
            inactive: bind-interface {{ each.bind_interface['#text'] }};
            {% else %}
            bind-interface {{ each.bind_interface }};
            {% endif %}
            {% endif %}
            {% if each.df_bit is defined %}
            df-bit {{ each.df_bit }};
            {% endif %}
            {% if each.ike is defined %}
            ike {
                gateway {{ each.ike.gateway }};
                idle-time {{ each.ike.idle_time }};
                no-anti-replay;
                install-interval {{ each.ike.install_interval }};
                ipsec-policy {{ each.ike.ipsec_policy }};
            }
            {% endif %}
            {% if each.establish_tunnels is defined %}
            establish-tunnels {{ each.establish_tunnels }};
            {% endif %}
        }
        {% endfor %}
        {% else %}
        vpn {{ configuration_security.ipsec.vpn.name }} {
            {% if configuration_security.ipsec.vpn.bind_interface is defined %}
            {% if configuration_security.ipsec.vpn.bind_interface['@inactive'] is defined %}
            inactive: bind-interface {{ configuration_security.ipsec.vpn.bind_interface['#text'] }};
            {% else %}
            bind-interface {{ configuration_security.ipsec.vpn.bind_interface['#text'] }};
            {% endif %}
            {% endif %}
            {% if configuration_security.ipsec.vpn.df_bit is defined %}
            df-bit {{ configuration_security.ipsec.vpn.df_bit }};
            {% endif %}
            {% if configuration_security.ipsec.vpn.ike is defined %}
            ike {
                gateway {{ configuration_security.ipsec.vpn.ike.gateway }};
                ipsec-policy {{ configuration_security.ipsec.vpn.ike.ipsec_policy }};
            }
            {% endif %}
            {% if configuration_security.ipsec.vpn.establish_tunnels is defined %}
            establish-tunnels {{ configuration_security.ipsec.vpn.establish_tunnels }};
            {% endif %}
        }
        {% endif %}
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.address_book                                                        #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.address_book is defined %}
    address-book {
        {% if configuration_security.address_book is defined %}
        {{ configuration_security.address_book.name }} {
            {% if configuration_security.address_book.address is defined %}
            {% if configuration_security.address_book.address is not mapping and configuration_security.address_book.address is not string %}
            {% for each in configuration_security.address_book.address %}
            address {{ each.name }} {
                {% if each.description is defined %}
                description "{{ each.description }}";
                {% endif %}
                {% if each.ip_prefix is defined %}
                {{ each.ip_prefix }};
                {% endif %}
            }
            {% endfor %}
            {% else %}
            address {{ configuration_security.address_book.address.name }} {
                {% if configuration_security.address_book.address.description is defined %}
                description "{{ configuration_security.address_book.address.description }}";
                {% endif %}
                {% if configuration_security.address_book.address.ip_prefix is defined %}
                {{ each.ip_prefix }};
                {% endif %}
            }
            {% endif %}
            {% endif %}
            {% if configuration_security.address_book.address_set is defined %}
            {% if configuration_security.address_book.address_set is not mapping and configuration_security.address_book.address_set is not string %}
            {% for each in configuration_security.address_book.address_set %}
            address-set {{ each.name }} {
                {% if each.address is not mapping and each.address is not string %}
                {% for item in each.address %}
                address {{ item.name }};
                {% endfor %}
                {% else %}
                address {{ each.address.name }};
                {% endif %}
            }
            {% endfor %}
            {% else %}
            address-set {{ configuration_security.address_book.address_set.name }} {
                {% if configuration_security.address_book.address_set.address is not mapping and configuration_security.address_book.address_set.address is not string %}
                {% for item in configuration_security.address_book.address_set.address %}
                address {{ item.name }};
                {% endfor %}
                {% else %}
                address {{ configuration_security.address_book.address_set.address.name }};
                {% endif %}
            }
            {% endif %}
            {% endif %}
        }
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.application_tracking                                                #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.application_tracking is defined %}
    application-tracking {
        {% if configuration_security.application_tracking.first_update is defined %}
        first-update;
        {% endif %}
        {% if configuration_security.application_tracking.session_update_interval is defined %}
        session-update-interval {{ configuration_security.application_tracking.session_update_interval }};
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.forwarding_options                                                  #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.forwarding_options is defined %}
    forwarding-options {
        {% if configuration_security.forwarding_options.family is defined %}
        family {
            {% if configuration_security.forwarding_options.family.inet6 is defined %}
            inet6 {
                mode {{ configuration_security.forwarding_options.family.inet6.mode }};
            }
            {% endif %}
        }
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.flow                                                                #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.flow is defined %}
    flow {
        {% if configuration_security.flow.traceoptions is defined %}
        traceoptions {
            {% if configuration_security.flow.traceoptions.file is defined %}
            file {{ configuration_security.flow.traceoptions.file.filename }};
            {% endif %}
            {% if configuration_security.flow.traceoptions.flag is defined %}
            flag {{ configuration_security.flow.traceoptions.flag.name }};
            {% endif %}
            {% if configuration_security.flow.traceoptions.packet_filter is defined %}
            packet-filter {{ configuration_security.flow.traceoptions.packet_filter.name }} {
                source-prefix {{ configuration_security.flow.traceoptions.packet_filter.source_prefix }};
                destination-prefix {{ configuration_security.flow.traceoptions.packet_filter.destination_prefix }};
            }
            {% endif %}
        }
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.screen                                                              #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.screen is defined %}
    screen {
        {% if configuration_security.screen.ids_option is defined %}
        ids-option {{ configuration_security.screen.ids_option.name }} {
            {% if configuration_security.screen.ids_option.icmp is defined %}
            icmp {
                {% if configuration_security.screen.ids_option.icmp.ping_death is defined %}
                ping-death;
                {% endif %}
            }
            {% endif %}
            {% if configuration_security.screen.ids_option.ip is defined %}
            ip {
                {% if configuration_security.screen.ids_option.ip.source_route_option is defined %}
                source-route-option;
                {% endif %}
                {% if configuration_security.screen.ids_option.ip.tear_drop is defined %}
                tear-drop;
                {% endif %}
            }
            {% endif %}
            {% if configuration_security.screen.ids_option.tcp is defined %}
            tcp {
                {% if configuration_security.screen.ids_option.tcp.syn_flood is defined %}
                syn-flood {
                    {% if configuration_security.screen.ids_option.tcp.syn_flood.alarm_threshold is defined %}
                    alarm-threshold {{ configuration_security.screen.ids_option.tcp.syn_flood.alarm_threshold }};
                    {% endif %}
                    {% if configuration_security.screen.ids_option.tcp.syn_flood.attack_threshold is defined %}
                    attack-threshold {{ configuration_security.screen.ids_option.tcp.syn_flood.attack_threshold }};
                    {% endif %}
                    {% if configuration_security.screen.ids_option.tcp.syn_flood.source_threshold is defined %}
                    source-threshold {{ configuration_security.screen.ids_option.tcp.syn_flood.source_threshold }};
                    {% endif %}
                    {% if configuration_security.screen.ids_option.tcp.syn_flood.destination_threshold is defined %}
                    destination-threshold {{ configuration_security.screen.ids_option.tcp.syn_flood.destination_threshold }};
                    {% endif %}
                    {% if configuration_security.screen.ids_option.tcp.syn_flood.timeout is defined %}
                    timeout {{ configuration_security.screen.ids_option.tcp.syn_flood.timeout }};
                    {% endif %}
                }
                {% endif %}
                {% if configuration_security.screen.ids_option.tcp.land is defined %}
                land;
                {% endif %}
            }
            {% endif %}
        }
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.nat                                                                 #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.nat is defined %}
    nat {
        {# ----------------------------------------------------------------------------------- #}
        {# configuration_security.nat.source                                                          #}
        {# ----------------------------------------------------------------------------------- #}
        {% if configuration_security.nat.source is defined %}
        source {
            {% if configuration_security.nat.source.rule_set is defined %}
            {% if configuration_security.nat.source.rule_set is not mapping and configuration_security.nat.source.rule_set is not string %}
            {% for each in configuration_security.nat.source.rule_set %}
            rule-set {{ each.name }} {
                {% if each.from is defined %}
                from zone {{ each.from.zone[0] }};
                {% endif %}
                {% if each.to is defined %}
                to zone {{ each.to.zone[0] }};
                {% endif %}
                {% if each.rule is defined %}
                {% if each.rule is not mapping and each.rule is not string %}
                {% for rule in each.rule %}
                rule {{ rule.name }} {
                    {% if rule.src_nat_rule_match is defined %}
                    match {
                        source-address {{ rule.src_nat_rule_match.source_address[0] }};
                        destination-address {{ rule.src_nat_rule_match.destination_address[0] }};
                    }
                    {% endif %}
                    {% if rule.then is defined %}
                    then {
                        {% if rule.then.source_nat is defined %}
                        source-nat {
                            {% if rule.then.source_nat.interface is defined %}
                            interface;
                            {% else %}
                            off;
                            {% endif %}
                        }
                        {% endif %}
                    }
                    {% endif %}
                }
                {% endfor %}
                {% else %}
                rule {{ each.rule.name }} {
                    {% if each.rule.src_nat_rule_match is defined %}
                    match {
                        source-address {{ each.rule.src_nat_rule_match.source_address }};
                        destination-address {{ each.rule.src_nat_rule_match.destination_address }};
                    }
                    {% endif %}
                    {% if each.rule.then is defined %}
                    then {
                        {% if each.rule.then.source_nat is defined %}
                        source-nat {
                            {% if each.rule.then.source_nat.interface is defined %}
                            interface;
                            {% endif %}
                        }
                        {% endif %}
                    }
                    {% endif %}
                }
                {% endif %}
                {% endif %}
            }
            {% endfor %}
            {% else %}
            rule-set {{ configuration_security.nat.source.rule_set.name }} {
                {% if configuration_security.nat.source.rule_set.from is defined %}
                from zone {{ configuration_security.nat.source.rule_set.from.zone }};
                {% endif %}
                {% if configuration_security.nat.source.rule_set.to is defined %}
                to zone {{ configuration_security.nat.source.rule_set.to.zone }};
                {% endif %}
                {% if configuration_security.nat.source.rule_set.rule is defined %}
                {% if configuration_security.nat.source.rule_set.rule is not mapping and configuration_security.nat.source.rule_set.rule is not string %}
                {% for each in configuration_security.nat.source.rule_set.rule %}
                rule {{ each.name }} {
                    {% if each.src_nat_rule_match is defined %}
                    match {
                        source-address {{ each.src_nat_rule_match.source_address }};
                        destination-address {{ each.src_nat_rule_match.destination_address }};
                    }
                    {% endif %}
                    {% if each.then is defined %}
                    then {
                        {% if each.then.source_nat is defined %}
                        source-nat {
                            {% if each.then.source_nat.interface is defined %}
                            interface;
                            {% endif %}
                        }
                        {% endif %}
                    }
                    {% endif %}
                }
                {% endfor %}
                {% else %}
                rule {{ configuration_security.nat.source.rule_set.rule.name }} {
                    {% if configuration_security.nat.source.rule_set.rule.src_nat_rule_match is defined %}
                    match {
                        source-address {{ configuration_security.nat.source.rule_set.rule.src_nat_rule_match.source_address }};
                        destination-address {{ configuration_security.nat.source.rule_set.rule.src_nat_rule_match.destination_address }};
                    }
                    {% endif %}
                    {% if configuration_security.nat.source.rule_set.rule.then is defined %}
                    then {
                        {% if configuration_security.nat.source.rule_set.rule.then.source_nat is defined %}
                        source-nat {
                            {% if configuration_security.nat.source.rule_set.rule.then.source_nat.interface is defined %}
                            interface;
                            {% endif %}
                        }
                        {% endif %}
                    }
                    {% endif %}
                }
                {% endif %}
                {% endif %}
            }
            {% endif %}
            {% endif %}
        }
        {% endif %}
        {# ----------------------------------------------------------------------------------- #}
        {# configuration_security.nat.destination                                                     #}
        {# ----------------------------------------------------------------------------------- #}
        {% if configuration_security.nat.destination is defined %}
        destination {
            {# ----------------------------------------------------------------------------------- #}
            {# configuration_security.nat.destination.pool                                                #}
            {# ----------------------------------------------------------------------------------- #}
            {% if configuration_security.nat.destination.pool is defined %}
            {% if configuration_security.nat.destination.pool is not mapping and configuration_security.nat.destination.pool is not string %}
            {% for each in configuration_security.nat.destination.pool %}
            pool {{ each.name }} {
                address {{ each.address.ipaddr }} port {{ each.address.port }};
            }
            {% endfor %}
            {% else %}
            pool {{ configuration_security.nat.destination.pool.name }} {
                address {{ configuration_security.nat.destination.pool.address.ipaddr }} port {{ configuration_security.nat.destination.pool.address.port }};
            }
            {% endif %}
            {% endif %}
            {# ----------------------------------------------------------------------------------- #}
            {# configuration_security.nat.destination.rule_set                                            #}
            {# ----------------------------------------------------------------------------------- #}
            {% if configuration_security.nat.destination.rule_set is defined %}
            {# ----------------------------------------------------------------------------------- #}
            {# multiple configuration_security.nat.destination.rule_set                                   #}
            {# ----------------------------------------------------------------------------------- #}
            {% if configuration_security.nat.destination.rule_set is not mapping and configuration_security.nat.destination.rule_set is not string %}
            {% for each in configuration_security.nat.destination.rule_set %}
            rule-set {{ each.name }} {
                {% if each.from is defined %}
                from zone {{ each.from.zone[0] }};
                {% endif %}
                {% for item in each.rule %}
                rule {{ item.name }} {
                    {% if item.dest_nat_rule_match is defined %}
                    match {
                        {% if item.dest_nat_rule_match.destination_address is defined %}
                        destination-address {{ item.dest_nat_rule_match.destination_address.dst_addr }};
                        {% endif %}
                        {% if item.dest_nat_rule_match.destination_port is defined %}
                        destination-port {
                            {% if item.dest_nat_rule_match.destination_port is not mapping and item.dest_nat_rule_match.destination_port is not string %}
                            {% for port in item.dest_nat_rule_match.destination_port %}
                            {{ port.name }};
                            {% endfor %}
                            {% else %}
                            {{ item.dest_nat_rule_match.destination_port.name }};
                            {% endif %}
                        }
                        {% endif %}
                    }
                    {% endif %}
                    {% if item.then is defined %}
                    then {
                        {% if item.then.destination_nat is defined %}
                        destination-nat {
                            {% if item.then.destination_nat.pool is defined %}
                            pool {
                                {% if item.then.destination_nat.pool.pool_name is defined %}
                                {{ item.then.destination_nat.pool.pool_name }};
                                {% endif %}
                            }
                            {% endif %}
                        }
                        {% endif %}
                    }
                    {% endif %}
                }
                {% endfor %}
            }
            {% endfor %}
            {% else %}
            {# ----------------------------------------------------------------------------------- #}
            {# single configuration_security.nat.destination.rule_set                                     #}
            {# ----------------------------------------------------------------------------------- #}
            rule-set {{ configuration_security.nat.destination.rule_set.name }} {
                {% if configuration_security.nat.destination.rule_set.from is defined %}
                from zone {{ configuration_security.nat.destination.rule_set.from.zone }};
                {% endif %}
                {% for item in configuration_security.nat.destination.rule_set.rule %}
                rule {{ item.name }} {
                    {% if item.dest_nat_rule_match is defined %}
                    match {
                        {% if item.dest_nat_rule_match.destination_address is defined %}
                        destination-address {{ item.dest_nat_rule_match.destination_address.dst_addr }};
                        {% endif %}
                        {% if item.dest_nat_rule_match.destination_port is defined %}
                        destination-port {
                            {% if item.dest_nat_rule_match.destination_port is not mapping and item.dest_nat_rule_match.destination_port is not string %}
                            {% for port in item.dest_nat_rule_match.destination_port %}
                            {{ port.name }};
                            {% endfor %}
                            {% else %}
                            {{ item.dest_nat_rule_match.destination_port.name }};
                            {% endif %}
                        }
                        {% endif %}
                    }
                    {% endif %}
                    {% if item.then is defined %}
                    then {
                        {% if item.then.destination_nat is defined %}
                        destination-nat {
                            {% if item.then.destination_nat.pool is defined %}
                            pool {
                                {% if item.then.destination_nat.pool.pool_name is defined %}
                                {{ item.then.destination_nat.pool.pool_name }};
                                {% endif %}
                            }
                            {% endif %}
                        }
                        {% endif %}
                    }
                    {% endif %}
                }
                {% endfor %}
            }
            {% endif %}
            {% endif %}
        }
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.forwarding_process                                                  #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.forwarding_process is defined %}
    forwarding-process {
         {% if configuration_security.forwarding_process.enhanced_services_mode is defined %}
        enhanced-services-mode;
        {% endif %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.policies                                                            #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.policies is defined %}
    policies {
        {# ----------------------------------------------------------------------------------- #}
        {# policy                                                                              #}
        {# ----------------------------------------------------------------------------------- #}
        {% for each in configuration_security.policies.policy %}
        {% if each.from_zone_name and each.to_zone_name is defined %}
        from-zone {{ each.from_zone_name }} to-zone {{ each.to_zone_name }} {
            {% if each.policy is not mapping and each.policy is not string %}
            {% for item in each.policy %}
            {% if item['@inactive'] is defined %}
            inactive: policy {{ item.name }} {
            {% else %}
            policy {{ item.name }} {
            {% endif %}
                match {
                    {% if item.match.source_address is defined %}
                    {% if item.match.source_address is not mapping and item.match.source_address is not string %}
                    source-address [ {{ item.match.source_address|join(' ') }} ];
                    {% else %}
                    source-address {{ item.match.source_address }};
                    {% endif %}
                    {% endif %}
                    {% if item.match.destination_address is defined %}
                    destination-address {{ item.match.destination_address }};
                    {% endif %}
                    {% if item.match.application is defined %}
                    {% if item.match.application is not mapping and item.match.application is not string %}
                    application [ {{ item.match.application|join(' ') }} ];
                    {% else %}
                    application {{ item.match.application }};
                    {% endif %}
                    {% endif %}
                }
                {% if item.then is defined %}
                then {
                    {% if item.then.permit is defined %}
                    permit;
                    {% endif %}
                    {% if item.then.log is defined %}
                    log {
                        {% if item.then.log.session_init is defined %}
                        session-init;
                        {% endif %}
                        {% if item.then.log.session_close is defined %}
                        session-close;
                        {% endif %}
                    }
                    {% endif %}
                    {% if item.then.deny is defined %}
                    deny;
                    {% endif %}
                    {% if item.then.count is defined %}
                    count;
                    {% endif %}
                }
                {% endif %}
            }
            {% endfor %}
            {% else %}
            policy {{ each.policy.name }} {
                match {
                    {% if each.policy.match.source_address is defined %}
                    source-address {{ each.policy.match.source_address }};
                    {% endif %}
                    {% if each.policy.match.destination_address is defined %}
                    destination-address {{ each.policy.match.destination_address }};
                    {% endif %}
                    {% if each.policy.match.application is defined %}
                    application {{ each.policy.match.application }};
                    {% endif %}
                }
                {% if each.policy.then is defined %}
                then {
                    {% if each.policy.then.permit is defined %}
                    permit;
                    {% endif %}
                }
                {% endif %}
            }
            {% endif %}
        }
        {% endif %}
        {% endfor %}
    }
    {% endif %}
    {# ----------------------------------------------------------------------------------- #}
    {# configuration_security.zones                                                               #}
    {# ----------------------------------------------------------------------------------- #}
    {% if configuration_security.zones is defined %}
    zones {
        {% for each in configuration_security.zones.security_zone %}
        security-zone {{ each.name }} {
            {# ----------------------------------------------------------------------------------- #}
            {# description                                                                         #}
            {# ----------------------------------------------------------------------------------- #}
            {% if each.description is defined %}
            description "{{ each.description }}";
            {% endif %}
            {# ----------------------------------------------------------------------------------- #}
            {# tcp-rst                                                                             #}
            {# ----------------------------------------------------------------------------------- #}
            {% if each.tcp_rst is defined %}
            tcp-rst;
            {% endif %}
            {# ----------------------------------------------------------------------------------- #}
            {# screen                                                                              #}
            {# ----------------------------------------------------------------------------------- #}
            {% if each.screen is defined %}
            screen {{ each.screen }};
            {% endif %}
            {# ----------------------------------------------------------------------------------- #}
            {# configuration_security.host_inbound_traffic                                                #}
            {# ----------------------------------------------------------------------------------- #}
            {% if each.host_inbound_traffic is defined %}
            host-inbound-traffic {
                {# ----------------------------------------------------------------------------------- #}
                {# configuration_security.system_services                                                     #}
                {# ----------------------------------------------------------------------------------- #}
                {% if each.host_inbound_traffic.system_services is defined %}
                system-services {
                    {% if each.host_inbound_traffic.system_services is not mapping and each.host_inbound_traffic.system_services is not string %}
                    {% for item in each.host_inbound_traffic.system_services %}
                    {{ item.name }};
                    {% endfor %}
                    {% else %}
                    {{ each.host_inbound_traffic.system_services.name }};
                    {% endif %}
                }
                {% endif %}
                {# ----------------------------------------------------------------------------------- #}
                {# configuration_security.protocols                                                           #}
                {# ----------------------------------------------------------------------------------- #}
                {% if each.host_inbound_traffic.protocols is defined %}
                protocols {
                    {% if each.host_inbound_traffic.protocols is not mapping and each.host_inbound_traffic.protocols is not string %}
                    {% for item in each.host_inbound_traffic.protocols %}
                    {{ item.name }};
                    {% endfor %}
                    {% else %}
                    {{ each.host_inbound_traffic.protocols.name }};
                    {% endif %}
                }
                {% endif %}
            }
            {% endif %}
            {% if each.interfaces is defined %}
            interfaces {
                {% if each.interfaces is not mapping and each.interfaces is not string %}
                {% for item in each.interfaces %}
                {{ item.name }};
                {% endfor %}
                {% else %}
                {{ each.interfaces.name }};
                {% endif %}
            }
            {% endif %}
            {# ----------------------------------------------------------------------------------- #}
            {# application_tracking                                                #}
            {# ----------------------------------------------------------------------------------- #}
            {% if each.application_tracking is defined %}
            application-tracking;
            {% endif %}
        }
        {% endfor %}
    }
    {% endif %}
}
{% endif %}